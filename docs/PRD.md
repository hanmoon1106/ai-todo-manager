# PRD — AI 기반 할 일(Todo) 관리 웹앱

- 문서 버전: v1.0  
- 최종 업데이트: 2026-02-17  
- 대상: 기획/디자인/개발(프론트/백엔드) 공용  
- 산출물 목표: **바로 개발 착수 가능한 수준**의 요구사항/데이터/권한/화면 정의

---

## 1. 제품 개요

사용자가 이메일/비밀번호로 로그인한 뒤, 개인 할 일을 생성·관리(CRUD)하고, 검색/필터/정렬로 빠르게 탐색하며, **AI**를 통해
1) 자연어 입력을 **구조화된 Todo 데이터로 변환(생성)** 하고  
2) 버튼 한 번으로 **일일/주간 요약 및 진행 분석**을 받는 웹앱.

---

## 2. 목표(Goals)

1. **인증 + 개인화 데이터 분리**: 사용자별 Todo 데이터가 절대 섞이지 않도록 강제(RLS).
2. **핵심 Todo 관리 경험**: CRUD + 검색/필터/정렬을 빠르고 직관적으로 제공.
3. **AI로 입력/정리 비용 절감**: 자연어 → 구조화(생성), 전체 Todo → 요약/분석 제공.
4. **확장 가능한 구조**: 추후 “통계/분석” 화면 추가가 자연스럽게 가능한 데이터/아키텍처.

---

## 3. 비목표(Non-goals)

- 팀/조직 공유 Todo(협업 기능), 권한 공유(예: 멤버 초대), 코멘트/첨부파일
- 푸시 알림/캘린더 동기화(외부 연동)
- 오프라인 모드/동기화
- 복잡한 프로젝트 관리(간트, 칸반 보드) — v1 범위 밖

---

## 4. 사용자/페르소나

- **개인 사용자(기본)**: 개인 일정/업무/학습을 한곳에서 관리.
- **초보 사용자**: “자연어로 입력하면 자동으로 정리되는” AI 기능을 선호.
- **파워 사용자(확장 대상)**: 필터/정렬로 빠르게 확인하고 주간 분석을 보고 싶어 함.

---

## 5. 핵심 사용자 시나리오

1. 신규 사용자가 회원가입 → 로그인 → 메인에서 Todo 추가
2. Todo를 우선순위/카테고리/상태로 필터링하고 마감일 순으로 정렬
3. “내일 오전 10시에 팀 회의 준비” 입력 → AI가 title/due_date/priority/category 등 추출 → 사용자 확인 후 저장
4. “AI 요약” 버튼 → 오늘 완료/미완료 요약 및 이번 주 완료율을 확인

---

## 6. 성공 지표(KPI) — 초기 제안

- 가입 후 1일 내 **첫 Todo 생성률**
- 주간 활성 사용자(WAU)
- Todo 1개 생성에 소요되는 평균 시간(특히 AI 생성 사용 시 감소)
- AI 생성 기능 사용률(전체 생성 중 AI 비율)
- 요약 기능 사용률(DAU 대비 요약 실행 비율)

---

## 7. 기능 요구사항

### 7.1 인증(이메일/비밀번호) — Supabase Auth

#### 요구사항
- 회원가입/로그인/로그아웃
- 로그인 상태 유지(세션)
- 비밀번호 재설정(이메일 링크 기반)

#### 화면/UX
- 로그인/회원가입 탭 전환
- 필수 입력: 이메일, 비밀번호
- 에러 메시지: 인증 실패/형식 오류/중복 이메일 등

#### 수용 기준(AC)
- 미로그인 사용자는 `/login`으로 리다이렉트
- 로그인 시 `/app`(메인)로 이동
- 로그아웃 시 세션 제거 후 `/login` 이동

---

### 7.2 Todo 관리(CRUD)

#### Todo 필드(요구사항)
- `title` (필수, 1~100자)
- `description` (선택, 최대 2000자)
- `created_date` (자동: 생성 시각)
- `due_date` (선택: 날짜+시간, 또는 날짜만)
- `priority` (필수, enum: `high | medium | low`, 기본 `medium`)
- `category` (선택, 문자열 또는 enum; v1은 문자열 허용 + 추천값 제공)
- `completed` (필수, boolean, 기본 `false`)

#### 동작 정의
- **Create**: 폼 입력 후 저장
- **Read**: 목록 조회(페이지 진입 시 기본 1회 로딩 + 조건 변경 시 재조회)
- **Update**:
  - 완료 체크 토글(리스트에서 즉시)
  - 제목/설명/마감/우선순위/카테고리 편집(모달 또는 상세 패널)
- **Delete**:
  - 단건 삭제(확인 다이얼로그)
  - (옵션) 완료 항목 일괄 삭제는 v2 후보

#### 상태(진행/완료/지연) 정의
- 진행 중: `completed=false` AND (due_date가 없거나 due_date >= now)
- 완료: `completed=true`
- 지연: `completed=false` AND due_date < now

> 시간 기준은 사용자 로컬 타임존(기본 KST)을 표시하되, DB 저장은 UTC 권장.

#### 수용 기준(AC)
- 본인 Todo만 조회/수정/삭제 가능(RLS)
- 제목 미입력 시 저장 불가 + 인라인 에러
- 완료 토글 후 UI 즉시 반영(optimistic update 가능)
- 삭제는 되돌릴 수 없음을 명확히 안내

---

### 7.3 검색/필터/정렬

#### 검색
- 대상: `title`, `description`
- 방식: 부분 일치(ILIKE)
- 입력 시 디바운스(예: 300ms) 후 조회

#### 필터
- 우선순위: high/medium/low
- 카테고리: 업무/개인/학습 등 프리셋 + 사용자 입력값도 포함(자동 완성)
- 진행 상태: 진행 중 / 완료 / 지연

#### 정렬
- 우선순위순(High→Medium→Low)
- 마감일순(빠른 마감 우선, due_date NULL은 뒤로)
- 생성일순(최신 우선)

#### 수용 기준(AC)
- 검색/필터/정렬 조합이 동시에 동작
- 조건 변경 시 결과가 즉시 갱신
- 조건 초기화 버튼 제공(전체 보기)

---

### 7.4 AI Todo 생성(자연어 → 구조화)

#### 목적
사용자 입력 문장을 분석해 Todo JSON을 생성하고, 사용자가 확인/수정 후 저장할 수 있게 함.

#### 입력/출력
- 입력 예: “내일 오전 10시에 팀 회의 준비”
- 출력 예(JSON):
```json
{
  "title": "팀 회의 준비",
  "description": "내일 오전 10시에 있을 팀 회의를 위해 자료 작성하기",
  "created_date": "YYYY-MM-DD, HH:MM",
  "due_date": "YYYY-MM-DD, 10:00",
  "priority": "high",
  "category": "업무",
  "completed": false
}
```

#### 요구사항
- AI 호출 버튼(또는 “AI로 만들기”) 제공
- AI 결과를 **미리보기/편집 가능**한 폼에 채워 넣기
- 사용자 확인 후 “저장”을 눌러야 DB 반영
- 날짜/시간 해석:
  - “내일/모레/다음 주” 등 상대 날짜 처리
  - 시간이 없으면 due_date는 날짜만 또는 NULL
- 카테고리 분류:
  - 문맥 기반 추천(업무/개인/학습 등) + 사용자가 수정 가능
- 우선순위 규칙:
  - 긴급/중요 표현(“당장”, “마감”, “회의”) 등으로 추론하되 기본은 medium

#### 예외/안전 장치
- JSON 파싱 실패 시: “AI 결과를 다시 생성” 또는 “텍스트로 받기” 후 수동 입력
- 부적절한 값(예: priority=urgent): 검증 후 매핑 또는 실패 처리
- due_date가 과거면 경고 표시(저장은 허용하되 사용자 확인)

#### 수용 기준(AC)
- AI 생성 결과는 저장 전까지 DB에 반영되지 않음
- 최소 필드(title/priority/completed) 검증 통과 필요
- AI 생성 후 사용자가 수정한 값이 최종 저장값이 됨

---

### 7.5 AI 요약 및 분석(버튼 1회 클릭)

#### 목적
사용자의 전체 Todo를 분석해 **일일 요약**과 **주간 요약/완료율**을 제공.

#### 일일 요약(오늘 기준)
- 오늘 완료된 항목 리스트(상위 N개 + “외 X개”)
- 오늘 남은 작업(미완료 + due_date가 오늘 또는 지연)
- 지연 항목 강조

#### 주간 요약(이번 주 기준)
- 이번 주 생성/완료 개수
- 완료율(완료/전체)
- 카테고리별 분포(텍스트 요약; 시각화는 통계 화면 확장 시)

#### UX
- “AI 요약” 버튼 클릭 → 로딩 상태(스피너) → 요약 카드 표시
- 결과는 화면에 보여주되 저장(로그) 여부는 v2 후보

#### 수용 기준(AC)
- 본인 Todo만 대상으로 분석
- 결과는 3~10초 내 응답을 목표(실패 시 재시도 안내)
- 데이터가 없으면 “요약할 항목이 없습니다” 안내

---

## 8. 화면 구성(PRD 수준 상세)

### 8.1 로그인/회원가입 화면 (`/login`)

#### 구성 요소
- 로고/서비스명
- 탭: 로그인 / 회원가입
- 입력: 이메일, 비밀번호
- 버튼: 로그인 / 회원가입
- 링크: 비밀번호 재설정

#### 상태
- 로딩 중, 에러(인증 실패), 성공(리다이렉트)

---

### 8.2 메인 Todo 화면 (`/app`)

#### 레이아웃(권장)
- 상단 바: 앱명, 사용자 메뉴(로그아웃)
- 좌측(또는 상단) 필터 패널:
  - 검색창
  - 필터(우선순위, 카테고리, 상태)
  - 정렬 드롭다운
  - 초기화 버튼
- 메인 영역:
  - Todo 추가 버튼(+)
  - Todo 리스트(카드/테이블)
  - AI 요약/분석 버튼
  - 요약 결과 카드(접힘/펼침 가능)

#### Todo 리스트 항목 UI
- 체크박스(완료)
- 제목(굵게)
- 보조 정보: due_date, priority 배지, category 배지
- 액션: 편집, 삭제

#### 인터랙션
- “+” 클릭 → 생성 모달(또는 우측 패널)
- “AI로 만들기” → 자연어 입력 모달 → 결과 폼 자동 채움
- “AI 요약” → 결과 카드 표시

---

### 8.3 통계/분석 화면(확장) (`/app/stats`) — v1.1~v2 후보

- 주간 활동량(생성/완료)
- 완료율 트렌드
- 카테고리별 비중
- 우선순위별 잔여 작업

> v1에서는 라우트/메뉴만 “준비”하고, 실제 차트는 추후 구현 가능.

---

## 9. 기술 스택

- 프론트/풀스택: Next.js(App Router)
- UI: Tailwind CSS, shadcn/ui
- 백엔드/DB/Auth: Supabase (Postgres + Auth)
- AI: Google Gemini API (AI SDK로 호출)
- 배포(권장): Vercel + Supabase

> 환경에 따라 배포는 변경 가능. 핵심은 “프론트에서 Supabase 연동 + 서버 라우트에서 AI 호출” 구조.

---

## 10. 시스템 아키텍처(권장)

### 10.1 권장 구조
- 클라이언트(브라우저)
  - Supabase Auth/DB 호출 (CRUD, 리스트)
- 서버(Next.js Route Handler / Server Action)
  - AI 호출(Gemini)
  - 프롬프트/스키마 검증/후처리

### 10.2 이유
- AI API 키를 클라이언트에 노출하지 않기 위해 서버에서만 호출
- JSON 스키마 검증을 서버에서 통제
- 추후 로깅/요금/레이트리밋 제어가 쉬움

---

## 11. 데이터 구조(Supabase)

### 11.1 테이블: `todos`

| 컬럼 | 타입 | 제약 | 설명 |
|---|---|---|---|
| id | uuid | PK, default gen_random_uuid() | Todo 식별자 |
| user_id | uuid | NOT NULL, FK → auth.users.id | 소유 사용자 |
| title | text | NOT NULL | 제목 |
| description | text | NULL | 설명 |
| created_at | timestamptz | NOT NULL, default now() | 생성 시각(UTC) |
| due_at | timestamptz | NULL | 마감 시각(UTC) |
| priority | text | NOT NULL, check in ('high','medium','low') | 우선순위 |
| category | text | NULL | 카테고리 |
| completed | boolean | NOT NULL, default false | 완료 여부 |
| completed_at | timestamptz | NULL | 완료 시각(UTC) |
| updated_at | timestamptz | NOT NULL, default now() | 수정 시각(UTC) |

#### 인덱스(권장)
- (user_id, created_at desc)
- (user_id, due_at asc)
- (user_id, completed, due_at)
- 검색 성능을 위해 title/description 트라이그램 인덱스는 데이터 규모 커질 때 추가 검토

### 11.2 users
- `auth.users`를 기본 사용(Supabase Auth)
- 추가 프로필이 필요하면 `profiles` 테이블 확장(v2 후보)

---

## 12. 보안/권한(RLS) — 필수

### 12.1 Row Level Security 정책(요구사항)
- `todos` 테이블은 RLS 활성화
- 정책:
  - SELECT: `auth.uid() = user_id`
  - INSERT: `auth.uid() = user_id`
  - UPDATE: `auth.uid() = user_id`
  - DELETE: `auth.uid() = user_id`

### 12.2 서버 AI 엔드포인트 보안
- AI 호출은 서버에서 수행
- 요청 시 사용자 인증 확인(세션 기반)
- 레이트리밋(초기에는 간단히 IP+user 기반; v2 고도화)

---

## 13. API/데이터 흐름 정의

### 13.1 Todo 조회
- 입력: 검색어, 필터, 정렬, 페이지(옵션)
- 출력: Todo 리스트 (+ 총 개수 옵션)

### 13.2 Todo 생성/수정/삭제
- Create: title 필수, 나머지 선택
- Update: 부분 업데이트 허용
- Delete: id 기반 단건

### 13.3 AI Todo 생성 API (서버)
- POST `/api/ai/parse-todo`
- Request:
```json
{ "text": "내일 오전 10시에 팀 회의 준비", "timezone": "Asia/Seoul" }
```
- Response:
```json
{
  "ok": true,
  "todo": {
    "title": "...",
    "description": "...",
    "due_at": "2026-02-18T01:00:00Z",
    "priority": "high",
    "category": "업무",
    "completed": false
  },
  "warnings": ["due_at inferred"]
}
```

### 13.4 AI 요약 API (서버)
- POST `/api/ai/summarize`
- Request:
```json
{ "range": "daily", "timezone": "Asia/Seoul" }
```
- Response:
```json
{ "ok": true, "summary_markdown": "..." }
```

> 요약 대상 Todo 데이터는 서버에서 Supabase로 재조회(권장).

---

## 14. AI 스키마 검증(권장)

- 서버에서 JSON 파싱 + 스키마 검증(예: Zod)
- 시간 표현은 timezone(Asia/Seoul)을 입력으로 받아 UTC로 변환 저장
- completed는 항상 false로 강제(파싱 결과가 true면 false로 덮어씀)

---

## 15. 엣지 케이스

- due_date가 없는 Todo: 상태는 “진행 중”
- due_date 과거 + completed=false: “지연”
- 동일 제목 다수: 허용
- 검색어 빈 문자열: 전체 조회
- 카테고리 자유 입력: 허용 + 추천값 제공
- AI 오분류: 사용자가 반드시 수정 가능

---

## 16. 성능/운영 요구사항

- 메인 목록 최초 로딩: 1~2초 목표
- AI 호출: 평균 3~10초, 실패 시 재시도 UX
- 페이지네이션(권장): 50개 단위
- 에러 로깅(Sentry 등): v2 후보

---

## 17. 테스트/수용 시나리오

1. 회원가입 → 로그인 → Todo 생성 → 새로고침 후 유지 확인
2. 다른 계정 로그인 시 기존 Todo가 보이지 않음(RLS)
3. 검색/필터/정렬 조합이 기대대로 동작
4. due_date 지난 Todo가 “지연”으로 표시
5. AI 파싱 → 폼 채움 → 수정 후 저장 시 수정값 반영
6. AI 요약: 오늘/주간 요약이 정상 표시

---

## 18. MVP 범위(우선순위)

### MVP(v1.0)
- Auth(이메일/비밀번호) + 로그아웃
- Todo CRUD
- 검색/필터/정렬
- AI Todo 생성(파싱)
- AI 요약(일일/주간)
- RLS/보안

### v1.1
- 통계 화면 라우트 + 기본 차트 1~2개
- 완료 일괄 처리/삭제 UX 개선

### v2
- 공유/협업, 알림/캘린더, 태그, 첨부파일, 히스토리

---

## 19. 일정(권장)

- Day 1~2: UI 틀 + Auth + 라우팅 가드
- Day 3~4: DB/RLS + CRUD
- Day 5: 검색/필터/정렬
- Day 6~7: AI 파싱 API + UI
- Day 8: AI 요약 API + UI
- Day 9: 테스트/버그픽스/배포

---

## 20. 오픈 이슈/결정 필요

1. 카테고리: enum 고정 vs 자유 입력(현재: 자유 입력 + 추천값)
2. due_date UI: 날짜만/날짜+시간 동시 지원 여부(권장: 둘 다)
3. AI 요약 결과 저장 여부(v1: 미저장 권장)
4. Todo 리스트 UI: 카드 vs 테이블(정보 밀도/가독성)
