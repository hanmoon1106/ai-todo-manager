# AI 할 일 관리 웹 서비스 개발 규칙

## 프로젝트 개요
Next.js 15 App Router 기반의 AI 기반 할 일 관리 웹 애플리케이션

---

## 1. 프로젝트 특성

### 사용자 경험 최우선
- **모든 상태를 UI로 표현**: 로딩 상태, 빈 상태, 오류 상태를 명확히 표시
- **상호작용 지연 최소화**: Optimistic UI 업데이트, Suspense 활용
- **접근성 고려**: 시맨틱 HTML, ARIA 속성, 키보드 네비게이션 지원

### 오류 처리 절차
- **서버/클라이언트 모두 예외 포착 필수**
  - try-catch 블록으로 예외 처리
  - Error Boundary 활용 (클라이언트 컴포넌트)
  - error.tsx 파일로 라우트 레벨 오류 처리
- **사용자 메시지는 한글로 친절하게**
  - 예: "할 일을 불러오는 중 문제가 발생했습니다. 잠시 후 다시 시도해 주세요."
- **개발 환경에서는 상세 로그 출력**
  - `console.error`로 에러 객체 전체 출력
  - 스택 트레이스 포함

---

## 2. 기술 스택

### 필수 기술
- **Next.js 16** (App Router)
- **TypeScript** (strict mode 권장)
- **Tailwind CSS** (유틸리티 우선 스타일링)
- **Shadcn/ui** (재사용 가능한 UI 컴포넌트)
- **Supabase** (인증, 데이터베이스, 실시간 기능)
- **AI SDK** (Vercel AI SDK - Google AI 모델 연동)
- **ESLint** (Next.js + TypeScript 규칙)

### 추가 라이브러리
- `zod`: 스키마 유효성 검사
- `react-hook-form`: 폼 관리
- `date-fns`: 날짜 처리
- `lucide-react`: 아이콘
- `sonner`: 토스트 알림

---

## 3. 코딩 스타일

### 컴포넌트 작성 규칙
- **함수형 컴포넌트를 기본으로 사용**
- **모든 함수는 화살표 함수로 작성**
  ```typescript
  // ✅ 올바른 예
  const TodoItem = ({ todo }: TodoItemProps) => {
    return <div>{todo.title}</div>;
  };

  // ❌ 잘못된 예
  function TodoItem({ todo }: TodoItemProps) {
    return <div>{todo.title}</div>;
  }
  ```

### 파일 및 폴더 구조
- **컴포넌트 파일명은 파스칼 케이스**
  - 예: `TodoList.tsx`, `AddTodoForm.tsx`
- **유틸리티/헬퍼 함수는 카멜 케이스**
  - 예: `formatDate.ts`, `validateTodo.ts`
- **폴더명은 케밥 케이스**
  - 예: `components/todo-list`, `lib/api-client`

### 주석 규칙
- **모든 함수/컴포넌트 상단에 한글 주석 필수**
  ```typescript
  /**
   * 할 일 목록을 표시하는 컴포넌트
   * @param todos - 표시할 할 일 배열
   * @param onToggle - 할 일 완료 상태 토글 핸들러
   */
  const TodoList = ({ todos, onToggle }: TodoListProps) => {
    // ...
  };
  ```
- **복잡한 로직에는 인라인 주석 추가**
  ```typescript
  // AI 응답을 파싱하여 할 일 객체로 변환
  const parsedTodo = parseTodoFromAI(aiResponse);
  ```

### TypeScript 규칙
- **타입을 명시적으로 정의**
  - Props는 인터페이스 또는 타입으로 정의
  - 함수 반환 타입 명시 (추론 가능한 경우 생략 가능)
- **any 사용 금지** (불가피한 경우 unknown 사용 후 타입 가드)
- **null 체크 필수** (옵셔널 체이닝, nullish coalescing 활용)

### ESLint 규칙 준수
- 커밋 전 `npm run lint` 실행 필수
- 경고를 무시하지 말고 수정
- `eslint-disable` 사용은 최소화 (사용 시 이유 주석 필수)

---

## 4. 컴포넌트 설계 원칙

### Server vs Client Components
- **기본은 Server Component로 작성**
  - 데이터 페칭, 초기 렌더링에 적합
- **다음의 경우 Client Component 사용**
  - `useState`, `useEffect` 등 React 훅 사용
  - 이벤트 핸들러 필요 (`onClick`, `onChange` 등)
  - 브라우저 API 사용 (`localStorage`, `window` 등)
  - 파일 최상단에 `'use client'` 지시어 추가

### 컴포넌트 분리
- **단일 책임 원칙 준수**
  - 하나의 컴포넌트는 하나의 역할만 수행
- **재사용 가능한 컴포넌트는 `components/ui`에 배치**
- **도메인 특화 컴포넌트는 `components/features`에 배치**
  - 예: `components/features/todo/TodoList.tsx`

### Props 설계
- **필수 props와 선택적 props 구분**
  ```typescript
  interface TodoItemProps {
    todo: Todo; // 필수
    onToggle: (id: string) => void; // 필수
    className?: string; // 선택적
  }
  ```
- **children은 ReactNode 타입 사용**

---

## 5. 상태 관리

### 클라이언트 상태
- **로컬 상태**: `useState` 사용
- **폼 상태**: `react-hook-form` 사용
- **전역 상태**: Context API 또는 Zustand 사용 (필요 시)

### 서버 상태
- **데이터 페칭**: Server Component에서 직접 fetch
- **클라이언트 페칭**: `useEffect` + `useState` 또는 SWR/React Query
- **낙관적 업데이트**: 사용자 경험 향상을 위해 적극 활용

---

## 6. 스타일링 규칙

### Tailwind CSS 사용
- **유틸리티 클래스 우선 사용**
- **복잡한 스타일은 `@apply` 사용 지양** (컴포넌트로 분리)
- **반응형 디자인 적용**
  - 모바일 우선: 기본 스타일 → `sm:` → `md:` → `lg:`
- **다크 모드 지원**
  - `dark:` 접두사 활용
  - `next-themes` 라이브러리 사용

### Shadcn/ui 컴포넌트
- **기본 컴포넌트를 최대한 활용**
- **커스터마이징 필요 시 `components/ui`에서 수정**
- **일관된 디자인 시스템 유지**

---

## 7. API 및 데이터베이스

### Supabase 사용
- **인증**: Supabase Auth (소셜 로그인, 이메일/비밀번호)
- **데이터베이스**: PostgreSQL
  - Row Level Security (RLS) 정책 필수
  - 사용자별 데이터 격리
- **실시간 기능**: Realtime Subscriptions (필요 시)

### API Routes (Server Actions)
- **Server Actions 우선 사용** (`'use server'`)
  ```typescript
  'use server';
  
  /**
   * 새로운 할 일을 추가합니다
   */
  export const addTodo = async (formData: FormData) => {
    // 인증 확인
    // 데이터 검증
    // DB 저장
  };
  ```
- **데이터 검증**: Zod 스키마로 입력값 검증
- **에러 처리**: try-catch로 감싸고 적절한 에러 반환

### AI 통합
- **Vercel AI SDK 사용**
  - `@ai-sdk/google` (Gemini 모델)
  - 스트리밍 응답 활용 (`useChat`, `streamText`)
- **프롬프트 엔지니어링**
  - 명확한 지시사항
  - 구조화된 출력 요청 (JSON 등)

---

## 8. 성능 최적화

### 이미지 최적화
- **Next.js Image 컴포넌트 사용**
  - `priority` 속성 활용 (LCP 이미지)
  - 적절한 `sizes` 속성 지정

### 코드 분할
- **Dynamic Import 활용**
  ```typescript
  const HeavyComponent = dynamic(() => import('@/components/HeavyComponent'), {
    loading: () => <Spinner />,
    ssr: false, // 클라이언트만 렌더링
  });
  ```

### 렌더링 최적화
- **불필요한 리렌더링 방지**
  - `React.memo` 사용 (필요 시)
  - `useCallback`, `useMemo` 활용
- **Suspense 및 로딩 상태 제공**
  - `loading.tsx` 파일 활용
  - Suspense Boundary 설정

---

## 9. 테스트 및 품질 관리

### 코드 품질
- **ESLint 규칙 준수**
- **TypeScript strict 모드 사용**
- **커밋 전 lint 실행 필수**

### Git 커밋 메시지
- **한글로 작성**
- **형식**: `[타입] 간결한 설명`
  - 예: `[feat] 할 일 추가 기능 구현`
  - 예: `[fix] 할 일 삭제 시 오류 수정`
- **타입**:
  - `feat`: 새로운 기능
  - `fix`: 버그 수정
  - `refactor`: 리팩토링
  - `style`: 스타일 변경
  - `docs`: 문서 수정
  - `chore`: 기타 작업

---

## 10. 보안

### 인증 및 인가
- **모든 API는 인증 확인 필수**
  ```typescript
  const user = await getUser();
  if (!user) {
    throw new Error('로그인이 필요합니다');
  }
  ```
- **RLS 정책으로 데이터 격리**

### 입력 검증
- **클라이언트와 서버 모두에서 검증**
- **Zod 스키마 활용**
- **XSS 방지**: React의 기본 이스케이프 활용

### 환경 변수
- **민감 정보는 `.env.local`에 저장**
- **`.env.example` 파일로 필요한 변수 문서화**
- **클라이언트 노출 변수는 `NEXT_PUBLIC_` 접두사 사용**

---

## 11. 접근성 (a11y)

### 시맨틱 HTML
- **적절한 HTML 태그 사용**
  - `<button>`, `<nav>`, `<main>`, `<article>` 등

### ARIA 속성
- **필요한 경우 ARIA 속성 추가**
  - `aria-label`, `aria-describedby` 등

### 키보드 네비게이션
- **모든 인터랙티브 요소는 키보드로 접근 가능**
- **포커스 스타일 명확히 표시**

---

## 12. 폴더 구조

```
ai-todo-manager/
├── app/                          # Next.js App Router
│   ├── (auth)/                  # 인증 관련 라우트
│   ├── (dashboard)/             # 대시보드 라우트
│   ├── api/                     # API Routes
│   ├── layout.tsx               # 루트 레이아웃
│   ├── page.tsx                 # 홈 페이지
│   ├── loading.tsx              # 로딩 UI
│   └── error.tsx                # 에러 UI
├── components/
│   ├── ui/                      # Shadcn/ui 컴포넌트
│   ├── features/                # 도메인 특화 컴포넌트
│   │   └── todo/
│   │       ├── TodoList.tsx
│   │       ├── TodoItem.tsx
│   │       └── AddTodoForm.tsx
│   └── layout/                  # 레이아웃 컴포넌트
│       ├── Header.tsx
│       └── Sidebar.tsx
├── lib/
│   ├── supabase/                # Supabase 클라이언트 및 유틸
│   ├── ai/                      # AI SDK 관련 유틸
│   ├── utils.ts                 # 공통 유틸리티
│   └── types.ts                 # 공통 타입 정의
├── hooks/                       # 커스텀 훅
├── public/                      # 정적 파일
└── .env.local                   # 환경 변수
```

---

## 13. 개발 워크플로우

### 개발 시작
```bash
npm run dev
```

### 빌드 및 배포 전 체크리스트
1. `npm run lint` 실행 → 경고 없음 확인
2. `npm run build` 실행 → 빌드 성공 확인
3. 테스트 환경에서 주요 기능 동작 확인
4. 환경 변수 설정 확인

---

## 14. 참고 자료
- [Next.js 공식 문서](https://nextjs.org/docs)
- [Tailwind CSS 공식 문서](https://tailwindcss.com/docs)
- [Shadcn/ui 공식 문서](https://ui.shadcn.com)
- [Supabase 공식 문서](https://supabase.com/docs)
- [Vercel AI SDK 공식 문서](https://sdk.vercel.ai/docs)
